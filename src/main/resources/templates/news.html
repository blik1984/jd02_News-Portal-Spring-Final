<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title th:text="${news.title}">–ù–æ–≤–æ—Å—Ç—å</title>

<meta name="viewport" content="width=device-width, initial-scale=1" />
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet" />

<style>
.category-badge {
	font-size: 0.8rem;
	background-color: #e9ecef;
	padding: 3px 8px;
	border-radius: 5px;
	margin-bottom: 10px;
	display: inline-block;
}

footer {
	background-color: #f8f9fa;
	padding: 20px 0;
	margin-top: 40px;
	text-align: center;
}

.news-content {
	font-size: 1.1rem;
	line-height: 1.7;
}

.comment-hidden-admin {
	font-size: 0.8rem;
	color: #b30000;
	font-style: italic;
}
</style>
</head>

<body>

	<header class="header-top">
		<div
			class="container d-flex justify-content-between align-items-center">
			<div>
				<a href="/" class="text-dark text-decoration-none fs-4 fw-bold">NewsPortal</a>
			</div>

			<div class="d-flex align-items-center">
				<div class="language-switcher me-3">
					<span>Language:</span> <a href="/SwitchLanguage?lang=ru"><button
							class="btn btn-sm btn-outline-secondary">RU</button></a> <a
						href="/SwitchLanguage?lang=en"><button
							class="btn btn-sm btn-outline-secondary">EN</button></a> <a
						href="/SwitchLanguage?lang=by"><button
							class="btn btn-sm btn-outline-secondary">BY</button></a>
				</div>

				<div>
					<span th:if="${currentUserName != null}" class="me-3">
						–ü—Ä–∏–≤–µ—Ç, <b th:text="${currentUserName}"></b>!
					</span> <a
						th:if="${currentUser != null and currentUser.role != null and currentUser.role.name() == 'ADMIN'}"
						href="/page_create_news" class="btn btn-primary btn-sm me-3">–°–æ–∑–¥–∞—Ç—å
						–Ω–æ–≤–æ—Å—Ç—å</a>

					<form th:if="${currentUserName != null}" th:action="@{/logout}"
						method="post" style="display: inline">
						<button class="btn btn-sm btn-outline-danger">–í—ã—Ö–æ–¥</button>
					</form>

					<a th:if="${currentUserName == null}" href="/page_auth"
						class="btn btn-sm btn-outline-primary me-2">–í–æ–π—Ç–∏</a> <a
						th:if="${currentUserName == null}" href="/page_registration"
						class="btn btn-sm btn-outline-success">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
				</div>
			</div>
		</div>
	</header>

	<div class="alert alert-warning" th:if="${param.message}"
		th:text="${param.message}"></div>

	<main class="container mt-4">

		<div class="mb-3">
			<a th:href="@{/(newsGroupId=${newsGroupId}, page=${currentPage})}">
				–ù–∞–∑–∞–¥ –∫ –Ω–æ–≤–æ—Å—Ç—è–º </a>
		</div>

		<!-- NEWS -->
		<div>
			<a th:href="@{/(newsGroupId=${news.newsGroup.id})}"
				class="badge bg-primary text-decoration-none"> <i
				class="bi bi-tags"></i> <span th:text="${news.newsGroup.name}"></span>
			</a>

			<h2 class="mt-2 mb-3" th:text="${news.title}"></h2>

			<p class="fw-bold" th:text="${news.brief}"></p>
			<th:block th:if="${news.authors != null and !news.authors.isEmpty()}">
				<div class="text-muted mb-2">
					<i class="bi bi-person"></i> <strong>–ê–≤—Ç–æ—Ä—ã:</strong> <span
						th:each="author, stat : ${news.authors}"> <span
						th:text="${author.name}"></span> <span th:if="${!stat.last}">,
					</span>
					</span>
				</div>
			</th:block>

			<hr />

			<div class="news-content" th:text="${news.content}"></div>

			<!-- ADMIN NEWS ACTIONS -->
			<div class="news-actions my-4"
				th:if="${currentUser != null and currentUser.role.name == 'ADMIN'}">

				<form th:action="@{/page_edit_news}" method="get" class="d-inline">
					<input type="hidden" name="newsId" th:value="${news.id}" />
					<button type="submit" class="btn btn-outline-primary me-2">‚úèÔ∏è
						–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</button>
				</form>

				<form th:action="@{/delete_news}" method="post" class="d-inline">
					<input type="hidden" name="newsId" th:value="${news.id}" />
					<button type="submit" class="btn btn-outline-danger"
						onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª?');">üóëÔ∏è
						–£–¥–∞–ª–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</button>
				</form>

			</div>
		</div>

		<!-- COMMENTS SECTION -->
		<div class="comments-section">

			<!-- ADD COMMENT FORM -->
			<form th:if="${currentUser != null and currentUser.activ == true}" th:action="@{/add_comment}"
				method="post" class="mb-4">
				<input type="hidden" name="newsId" th:value="${news.id}" /> <input
					type="hidden" name="newsGroupId" th:value="${newsGroupId}" /> <input
					type="hidden" name="currentPage" th:value="${currentPage}" />
				<textarea name="commentText" class="form-control mb-2"
					placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
				<button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
			</form>

			<h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>

			<!-- COMMENTS LIST -->
			<div th:each="comment : ${comments}"
				class="comment-block border rounded p-3 mb-3 bg-light">

				<p class="mb-1">
					<strong th:text="${comment.userName}"></strong> <small
						class="text-muted"> ‚Äî <span th:text="${comment.createdAt}"></span></small>

					<!-- admin mark for non-active comments -->
					<span
						th:if="${currentUser != null and currentUser.role.name == 'ADMIN' and !comment.activ}"
						class="comment-hidden-admin">(—Å–∫—Ä—ã—Ç—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π)</span>
				</p>

				<!-- COMMENT EDIT MODE -->
				<div th:if="${editingCommentId == comment.id}">
					<form th:action="@{/update_comment}" method="post">
						<input type="hidden" name="commentId" th:value="${comment.id}" />
						<input type="hidden" name="newsId" th:value="${news.id}" /> <input
							type="hidden" name="newsGroupId" th:value="${newsGroupId}" /> <input
							type="hidden" name="currentPage" th:value="${currentPage}" />
						<textarea name="commentText" class="form-control mb-2" required
							th:text="${comment.text}"></textarea>

						<button type="submit" class="btn btn-sm btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
						<a th:href="@{/(newsGroupId=${newsGroupId}, page=${currentPage})}"
							class="btn btn-sm btn-secondary">–û—Ç–º–µ–Ω–∞</a>

					</form>
				</div>

				<!-- DEFAULT VIEW -->
				<div th:if="${editingCommentId != comment.id}">
					<p th:text="${comment.text}"></p>

					<!-- AUTHOR CAN EDIT -->
					<form th:if="${comment.editable}" class="d-inline" method="get"
						th:action="@{/page_news}">
						<input type="hidden" name="newsId" th:value="${news.id}" /> <input
							type="hidden" name="editingCommentId" th:value="${comment.id}" />
						<input type="hidden" name="newsGroupId" th:value="${newsGroupId}" />
						<input type="hidden" name="currentPage" th:value="${currentPage}" />
						<button class="btn btn-sm btn-outline-primary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
					</form>

					<!-- ADMIN ACTIONS -->
					<span
						th:if="${currentUser != null and currentUser.role.name == 'ADMIN'}">

						<!-- TOGGLE ACTIVE -->
						<form th:action="@{/toggle_comment}" method="post"
							class="d-inline ms-2">
							<input type="hidden" name="commentId" th:value="${comment.id}" />
							<input type="hidden" name="newsId" th:value="${news.id}" /> <input
								type="hidden" name="newsGroupId" th:value="${newsGroupId}" /> <input
								type="hidden" name="currentPage" th:value="${currentPage}" />

							<button type="submit" class="btn btn-sm btn-outline-warning">
								<span th:text="${comment.activ ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'}"></span>
							</button>
						</form> <!-- DELETE -->
						<form th:action="@{/delete_comment}" method="post"
							class="d-inline ms-2">
							<input type="hidden" name="commentId" th:value="${comment.id}" />
							<input type="hidden" name="newsId" th:value="${news.id}" /> <input
								type="hidden" name="newsGroupId" th:value="${newsGroupId}" /> <input
								type="hidden" name="currentPage" th:value="${currentPage}" />
							<button type="submit" class="btn btn-sm btn-outline-danger"
								onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?');">–£–¥–∞–ª–∏—Ç—å
							</button>
						</form>

					</span>
				</div>

			</div>

		</div>

	</main>

	<footer>
		<div class="container">
			<p class="mb-0">
				¬© 2025 NewsPortal. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. | <a
					th:href="@{/page_privacy}">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
			</p>
		</div>
	</footer>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
