<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<title>Admin – Управление пользователями</title>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
	rel="stylesheet">
</head>
<body>

	<!-- ===== HEADER ===== -->
	<header class="header-top border-bottom mb-3">
		<div
			class="container d-flex justify-content-between align-items-center py-2">

			<!-- LOGO -->
			<a href="/" class="text-dark text-decoration-none fs-4 fw-bold">NewsPortal</a>

			<div class="d-flex align-items-center">

				<!-- Language -->
				<div class="me-3">
					<span>Language:</span> <a href="/SwitchLanguage?lang=ru"
						class="btn btn-sm btn-outline-secondary">RU</a> <a
						href="/SwitchLanguage?lang=en"
						class="btn btn-sm btn-outline-secondary">EN</a> <a
						href="/SwitchLanguage?lang=by"
						class="btn btn-sm btn-outline-secondary">BY</a>
				</div>

				<!-- AUTH -->
				<div th:if="${currentUserName != null}">
					<span class="me-3"> Привет, <b th:text="${currentUserName}">Admin</b>!
						<span
						th:if="${currentUser != null and currentUser.role != null and currentUser.role.name() == 'ADMIN'}"
						class="badge bg-danger ms-2">ADMIN</span>
					</span> <a
						th:if="${currentUser != null and currentUser.role != null and currentUser.role.name() == 'ADMIN'}"
						href="/page_create_news" class="btn btn-primary btn-sm me-2">
						<i class="bi bi-plus-circle"></i> Новость
					</a> <a href="/page_profile"
						class="btn btn-sm btn-outline-secondary me-2"> <i
						class="bi bi-person-circle"></i> Профиль
					</a>

					<form th:action="@{/logout}" method="post" class="d-inline">
						<button class="btn btn-sm btn-outline-danger">Выход</button>
					</form>
				</div>

			</div>
		</div>
	</header>

	<div class="container">

		<h3 class="mb-4">
			<i class="bi bi-people"></i> Управление пользователями
		</h3>

		<!-- Messages -->
		<div th:if="${successMessage != null}" class="alert alert-success"
			th:text="${successMessage}"></div>
		<div th:if="${errorMessage != null}" class="alert alert-danger"
			th:text="${errorMessage}"></div>

		<table class="table table-bordered align-middle">
			<thead class="table-light">
				<tr>
					<th>Имя</th>
					<th>Фамилия</th>
					<th>Email</th>
					<th>Дата регистрации</th>
					<th class="text-center">Активен</th>
					<th class="text-center">Автор</th>
					<th>Действия</th>
				</tr>
			</thead>

			<tbody>
				<tr th:each="user : ${users}">

					<td><input class="form-control" th:value="${user.name}"
						readonly></td>
					<td><input class="form-control" th:value="${user.surname}"
						readonly></td>
					<td th:text="${user.email}"></td>
					<td th:text="${user.registrationDate}"></td>

					<!-- UPDATE FORM -->
					<td class="text-center">
						<form th:action="@{'/user/update_admin_user/' + ${user.id}}"
							method="post">
							<input type="hidden" th:name="${_csrf.parameterName}"
								th:value="${_csrf.token}" /> <input type="checkbox"
								name="active" th:checked="${user.activ}"
								th:disabled="${currentUser != null and user.id == currentUser.id}">
					</td>

					<td class="text-center"><input type="checkbox" name="author"
						th:checked="${user.author}"></td>

					<td>
						<button class="btn btn-sm btn-primary">
							<i class="bi bi-save"></i> Сохранить
						</button>
						</form> <!-- DELETE FORM -->
						<form th:action="@{/user/delete}" method="post"
							th:if="${currentUser == null or user.id != currentUser.id}"
							onsubmit="return confirm('Вы уверены, что хотите удалить пользователя?');"
							class="d-inline">

							<input type="hidden" name="userId" th:value="${user.id}">
							<input type="hidden" th:name="${_csrf.parameterName}"
								th:value="${_csrf.token}" />

							<button class="btn btn-sm btn-danger ms-1">
								<i class="bi bi-trash"></i>
							</button>
						</form>
					</td>

				</tr>
			</tbody>
		</table>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
